{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Creates single Instance of App for testing purposes",

  "Parameters": {
    "ImageId": {
      "Description": "Provides the unique ID of the Amazon Machine Image (AMI)",
      "Type": "AWS::EC2::Image::Id",
      "Default": "ami-c998b6b2"
    },
    "InstanceType": {
      "Description": "The type of the ec2 instance you are creating",
      "Type": "String",
      "Default": "t2.micro"
    },
    "SubnetId": {
      "Description": "ID of the subnet you want to launch the instance into",
      "Type": "AWS::EC2::Subnet::Id",
      "Default": "subnet-d5b8c0b1"
    },
    "Timezone": {
      "Description": "Timezone",
      "Type": "String",
      "Default": "Chicago",
      "AllowedValues": ["New_York", "Chicago", "Denver", "Los_Angeles"]
    },
    "ApplicationName": {
      "Description": "Name of application the instance is a part of",
      "Type": "String",
      "Default": "Voting Arena"
    },
    "OwnerContact": {
      "Description": "Owner",
      "Type": "String",
      "Default": "likhith.matta@capitalone.com"
    },
    "Uptime": {
      "Description": "Uptime of the instance",
      "Type": "String",
      "Default": "8x5"
    },
    "Environment": {
      "Description": "Environment to which this instance belongs.",
      "Type": "String",
      "Default": "Dev"
    },
    "Index": {
      "Description": "Type of the stack Blue/green",
      "Type": "String",
      "Default": "Blue"
    },
    "Weight": {
      "Description": "Weight to be assigned to the stack",
      "Type": "String",
      "Default": "0"
    }
  },

  "Resources" : {
    "TestNode": {
      "Type": "AWS::EC2::Instance",
      "Properties" : {
        "ImageId": { "Ref": "ImageId" },
        "InstanceType": { "Ref": "InstanceType" },
        "SubnetId": { "Ref": "SubnetId" },
        "Tags": [
          {
            "Key": "Name",
            "Value": "Voting Arena Test Instance"
          },
          {
            "Key": "ApplicationName",
            "Value": { "Ref": "ApplicationName"}
          },
          {
            "Key": "OwnerContact",
            "Value": { "Ref": "OwnerContact" }
          },
          {
            "Key": "Uptime",
            "Value": { "Ref": "Uptime" }
          },
          {
            "Key": "Environment",
            "Value": { "Ref": "Environment" }
          }
        ],
        "KeyName": "Acc_846095599110",
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -v \n",
                "yum install -y java \n",
                "yum install -y wget \n",
                "mkdir App \n",
                "cd MyApp \n",
                "wget https://s3.amazonaws.com/java-artifacts-001/artifacts/IntuitCodingChallenge-17.12.01-SNAPSHOT.jar \n",
                "nohup java -jar IntuitCodingChallenge-17.12.01-SNAPSHOT.jar \n"
              ]
            ]
          }
        }
      }
    }
  }
}
